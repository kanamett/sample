<!DOCTYPE HTML>
<html>
<head>
<title>PhoneGap Showcase</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8"/>
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0.1/jquery.mobile-1.0.1.min.css" />
<script src="http://code.jquery.com/jquery-1.6.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.0.1/jquery.mobile-1.0.1.min.js"></script>
<script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
</head>
<body>
    <div data-role="page">
        <div data-role="header">
            <h1>Accelerometer Showcase</h1>
        </div>
        <div data-role="content">
            <a id="accelerometer_watch" href="#" data-role="button">計測開始</a>
            <div style="width:100%;height:150px;text-align:center;">
                <div id="accelerometer_watch_word" style="line-height:150px;font-size:100px; "></div>
            </div>

            <div id="accelerometer_watch_status"></div>
            <canvas id="c1" style="width:100%;"></canvas>

            <a id="accelerometer_clear" href="#" data-role="button">計測終了</a>
            <a id="accelerometer_now" href="#" data-role="button">今</a>
	<div id="message">message</span>
        </div>
    </div>
</body>

<script type="text/javascript">
var _accelerometer;
var _x;
var _y;
var _z;
var orgx = 70;
var orgy = 70;
var orgz = 30;

$(function(){
	document.addEventListener("deviceready",
		function(){
			$('#accelerometer_watch').attr('href', 'javascript:watchStartAccelerometer()');
			$('#accelerometer_clear').attr('href', 'javascript:watchStopAccelerometer()');
			$('#accelerometer_now').attr('href', 'javascript:watchNowAccelerometer()');
		},		false);

	var canvas = document.getElementById('c1');
	if (canvas.getContext) {
		orgx = canvas.width / 2;
		orgy = canvas.height / 2;
		orgz = canvas.width / 4;
	}
//	draw(orgx, orgy, orgz);
//	var canvas = document.getElementById('c1');
//	if (canvas.getContext) {
//		var ctx = canvas.getContext('2d');
//		ctx.fillStyle = "rgb(255, 0, 0)";
//ctx.strokeStyle = "rgb(0, 0, 0)";
//ctx.beginPath();
//ctx.moveTo( 20, 20.5 );
//ctx.lineTo( 320, 20.5 );
//ctx.moveTo( 20.5, 30 );
//ctx.lineTo( 20.5, 300 );
//ctx.stroke();
//	}
})
/*
 * 加速度センサー計測開始
 */
function watchNowAccelerometer() {
	$('#message').html("watchNowAccelerometer");
	try{
		navigator.accelerometer.getCurrentAcceleration(onSuccessFirst, onError);
	}catch( e ){
		alert( e );
	}
}
function watchStartAccelerometer(){
	watchNowAccelerometer();
	$('#message').html("watchStartAccelerometer");
	var options = { frequency: 100 }; 
	_accelerometer = navigator.accelerometer.watchAcceleration(onSuccess, onError,options);
}
function onSuccessFirst(acceleration) {
	_x = acceleration.x;
	_y = acceleration.y;
	_z = acceleration.z;
	draw(orgx, orgy, orgz);
}
function onSuccess(acceleration) { 
	$('#message').html("onSuccess");
	$('#accelerometer_watch_status').html(
	  'x:' + acceleration.x + "<br>" +
	  'y:' + acceleration.y + "<br>" +
	  'z:' + acceleration.z + "<br>" +
	  '日付:' + new Date(acceleration.timestamp).toString());
  
		if(Math.abs(acceleration.x)>9){
			$('#accelerometer_watch_word').html("横")
		}else if(Math.abs(acceleration.y)>9){
			$('#accelerometer_watch_word').html("縦")
		}else if(Math.abs(acceleration.z)>9){
			$('#accelerometer_watch_word').html("水平")
		}else{
			 $('#accelerometer_watch_word').html("")
	}
	draw(orgx + (_x - acceleration.x) * 10, orgy + (_y - acceleration.y) * 10, orgz + (_z - acceleration.z) * 10);
}
function onError() { 
	$('#message').html("onError");
}
/*
 * 加速度センサー計測終了
 */
function watchStopAccelerometer(){
	 navigator.accelerometer.clearWatch(_accelerometer);
	 $('#accelerometer_watch_status').html('');
	 $('#accelerometer_watch_word').html('');
}

function draw(x, y, radius) {
  var canvas = document.getElementById('c1');

  if (canvas.getContext) {
    var ctx = canvas.getContext('2d');
ctx.clearRect(0,0,canvas.width,canvas.height);

        ctx.beginPath();
//        var x              = 25 + j * 50;             // x 座標
//        var y              = 25 + i * 50;             // y 座標
//        var radius         = 20;                      // 円弧の半径
        var startAngle     = 0;                       // 円孤の始点
        var endAngle       = Math.PI * 2;             // 円孤の終点
        var anticlockwise  = true// 時計回りまたは半時計回り

        ctx.arc(x, y, radius, startAngle, endAngle, anticlockwise);

//        ctx.fill();
        ctx.stroke();
  }
}</script>
</html>
